<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>&quot;DRM Plugin Architecture&quot;: OpenIPMPDRMInfo.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>OpenIPMPDRMInfo.h</h1><a href="_open_i_p_m_p_d_r_m_info_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00012 <span class="preprocessor">#if !defined (OPENIPMPDRMINFO_H)</span>
00013 <span class="preprocessor"></span><span class="preprocessor">#define OPENIPMPDRMINFO_H</span>
00014 <span class="preprocessor"></span>
00015 <span class="preprocessor">#include &lt;string&gt;</span>
00016 <span class="preprocessor">#include "<a class="code" href="_d_r_m_info_exception_8h.html">DRMInfoException.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="_d_r_m_logger_8h.html">DRMLogger.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="_i_cipher_8h.html">ICipher.h</a>"</span>
00019 
00020 <span class="preprocessor">#include "OpenIPMP.h"</span>
00021 
00023 <span class="keyword">namespace </span>DRMPlugin {
00024 
<a name="l00029"></a><a class="code" href="class_d_r_m_plugin_1_1_open_i_p_m_p_d_r_m_info.html">00029</a> <span class="keyword">class </span><a class="code" href="class_d_r_m_plugin_1_1_open_i_p_m_p_d_r_m_info.html">OpenIPMPDRMInfo</a> {
00030 <span class="keyword">public</span>:
<a name="l00040"></a><a class="code" href="class_d_r_m_plugin_1_1_open_i_p_m_p_d_r_m_info.html#a0">00040</a>   <a class="code" href="class_d_r_m_plugin_1_1_open_i_p_m_p_d_r_m_info.html#a0">OpenIPMPDRMInfo</a>(ByteT* data, UInt32T dataSize, <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html">DRMLogger</a>&amp; logger): encMethod(),
00041       contentID(), toolID(), rightsHost() {
00042     <span class="keywordflow">if</span> ((data == 0) || (dataSize == 0)) {
00043       logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OpenIPMPDRMInfo::ctor: invalid openIPMP DRM data."</span>);
00044       <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00045     }
00046     <span class="comment">// We try to parse openIPMP specific data.</span>
00047     encMethod = (*data);
00048     <span class="keywordflow">if</span> ((<a class="code" href="namespace_d_r_m_plugin.html#a9">EncMethod</a>(encMethod) != <a class="code" href="namespace_d_r_m_plugin.html#a9a2">AES128CTR</a>) &amp;&amp; (<a class="code" href="namespace_d_r_m_plugin.html#a9">EncMethod</a>(encMethod) != <a class="code" href="namespace_d_r_m_plugin.html#a9a4">BLOWFISH</a>)) {
00049       logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OpenIPMPDRMInfo::ctor: invalid encryption method."</span>);
00050       <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00051     }
00052     std::basic_string&lt;char&gt; ipmpString((<span class="keywordtype">char</span>*)(data + 1), (<span class="keywordtype">char</span>*)(data + dataSize));
00053     <span class="keywordtype">int</span> index = 0, ret;
00054     ret = ipmpString.find(<span class="charliteral">'\0'</span>, index);
00055     <span class="keywordflow">if</span> (ret == -1) {
00056       logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OpenIPMPDRMInfo::ctor: invalid openIPMP DRM data."</span>);
00057       <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00058     }
00059     toolID = (<span class="keywordtype">char</span>*)ipmpString.data();
00060     <span class="keywordflow">if</span> (toolID != OPENIPMP_TOOLID) {
00061       logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OpenIPMPDRMInfo::ctor: invalid openIPMP tool identifier."</span>);
00062       <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00063     }
00064     index = (ret + 1);
00065     ret = ipmpString.find(<span class="charliteral">'\0'</span>, index);
00066     <span class="keywordflow">if</span> (ret == -1) {
00067       logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OpenIPMPDRMInfo::ctor: invalid openIPMP DRM data."</span>);
00068       <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00069     }
00070     contentID = (<span class="keywordtype">char</span>*)(ipmpString.data() + index);
00071     <span class="keywordflow">if</span> (contentID == <span class="stringliteral">""</span>) {
00072       logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OpenIPMPDRMInfo::ctor: invalid content identifier."</span>);
00073       <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00074     }
00075     index = (ret + 1);
00076     ret = ipmpString.find(<span class="charliteral">'\0'</span>, index);
00077     <span class="keywordflow">if</span> (ret == -1) {
00078       logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OpenIPMPDRMInfo::ctor: invalid openIPMP DRM data."</span>);
00079       <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00080     }
00081     rightsHost = (<span class="keywordtype">char</span>*)(ipmpString.data() + index);
00082   }
00083 
<a name="l00095"></a><a class="code" href="class_d_r_m_plugin_1_1_open_i_p_m_p_d_r_m_info.html#a1">00095</a>   <a class="code" href="class_d_r_m_plugin_1_1_open_i_p_m_p_d_r_m_info.html#a0">OpenIPMPDRMInfo</a>(ByteT eMethod, <span class="keyword">const</span> std::string&amp; conID, <span class="keyword">const</span> std::string&amp;
00096       tID, <span class="keyword">const</span> std::string&amp; rHost, <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html">DRMLogger</a>&amp; logger): encMethod(eMethod),
00097       contentID(conID), toolID(tID), rightsHost(rHost) {
00098     <span class="keywordflow">if</span> ((<a class="code" href="namespace_d_r_m_plugin.html#a9">EncMethod</a>(encMethod) != <a class="code" href="namespace_d_r_m_plugin.html#a9a2">AES128CTR</a>) &amp;&amp; (<a class="code" href="namespace_d_r_m_plugin.html#a9">EncMethod</a>(encMethod) != <a class="code" href="namespace_d_r_m_plugin.html#a9a4">BLOWFISH</a>)) {
00099       logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OpenIPMPDRMInfo::ctor: invalid encryption method."</span>);
00100       <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00101     }
00102     <span class="keywordflow">if</span> (contentID == <span class="stringliteral">""</span>) {
00103       logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OpenIPMPDRMInfo::ctor: invalid content identifier."</span>);
00104       <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00105     }
00106     <span class="keywordflow">if</span> (toolID != OPENIPMP_TOOLID) {
00107       logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OpenIPMPDRMInfo::ctor: invalid openIPMP tool identifier."</span>);
00108       <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00109     }
00110   }
00111 
<a name="l00114"></a><a class="code" href="class_d_r_m_plugin_1_1_open_i_p_m_p_d_r_m_info.html#a2">00114</a>   <a class="code" href="class_d_r_m_plugin_1_1_open_i_p_m_p_d_r_m_info.html#a0">OpenIPMPDRMInfo</a>(<span class="keyword">const</span> <a class="code" href="class_d_r_m_plugin_1_1_open_i_p_m_p_d_r_m_info.html">OpenIPMPDRMInfo</a>&amp; info): encMethod(info.encMethod),
00115     contentID(info.contentID), toolID(info.toolID), rightsHost(info.rightsHost) {
00116   }
00117 
<a name="l00122"></a><a class="code" href="class_d_r_m_plugin_1_1_open_i_p_m_p_d_r_m_info.html#a3">00122</a>   ByteT <a class="code" href="class_d_r_m_plugin_1_1_open_i_p_m_p_d_r_m_info.html#a3">GetEncMethod</a>()<span class="keyword"> const </span>{
00123     <span class="keywordflow">return</span> encMethod;
00124   }
00125 
<a name="l00130"></a><a class="code" href="class_d_r_m_plugin_1_1_open_i_p_m_p_d_r_m_info.html#a4">00130</a>   <span class="keyword">const</span> std::string&amp; <a class="code" href="class_d_r_m_plugin_1_1_open_i_p_m_p_d_r_m_info.html#a4">GetContentID</a>()<span class="keyword"> const </span>{
00131     <span class="keywordflow">return</span> contentID;
00132   }
00133 <span class="comment">/*</span>
00134 <span class="comment">  std::string&amp; GetContentID() {</span>
00135 <span class="comment">    return contentID;</span>
00136 <span class="comment">  }</span>
00137 <span class="comment">*/</span>
<a name="l00142"></a><a class="code" href="class_d_r_m_plugin_1_1_open_i_p_m_p_d_r_m_info.html#a5">00142</a>   <span class="keyword">const</span> std::string&amp; <a class="code" href="class_d_r_m_plugin_1_1_open_i_p_m_p_d_r_m_info.html#a5">GetToolID</a>()<span class="keyword"> const </span>{
00143     <span class="keywordflow">return</span> toolID;
00144   }
00145 
<a name="l00150"></a><a class="code" href="class_d_r_m_plugin_1_1_open_i_p_m_p_d_r_m_info.html#a6">00150</a>   <span class="keyword">const</span> std::string&amp; <a class="code" href="class_d_r_m_plugin_1_1_open_i_p_m_p_d_r_m_info.html#a6">GetRightsHost</a>()<span class="keyword"> const </span>{
00151     <span class="keywordflow">return</span> rightsHost;
00152   }
00153 <span class="comment">/*</span>
00154 <span class="comment">  std::string&amp; GetRightsHost() {</span>
00155 <span class="comment">    return rightsHost;</span>
00156 <span class="comment">  }</span>
00157 <span class="comment">*/</span>
00158 <span class="keyword">private</span>:
00159   ByteT encMethod;
00160   std::string contentID;
00161   std::string toolID;
00162   std::string rightsHost;
00163 };
00164 
00165 } <span class="comment">// namespace DRMPlugin</span>
00166 
00167 <span class="preprocessor">#endif // !defined (OPENIPMPDRMINFO_H)</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Jun 10 19:17:59 2006 for "DRM Plugin Architecture" by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
