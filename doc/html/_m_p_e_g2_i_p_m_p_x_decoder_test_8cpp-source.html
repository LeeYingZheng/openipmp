<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>&quot;DRM Plugin Architecture&quot;: MPEG2IPMPXDecoderTest.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>MPEG2IPMPXDecoderTest.cpp</h1><a href="_m_p_e_g2_i_p_m_p_x_decoder_test_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00017 <span class="preprocessor">#include "<a class="code" href="_m_p_e_g2_i_p_m_p_x_parser_8h.html">MPEG2IPMPXParser.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="_i_p_m_p_tool_manager_8h.html">IPMPToolManager.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="_thread_sync_factory_8h.html">ThreadSyncFactory.h</a>"</span>
00020 <span class="preprocessor">#include &lt;iostream&gt;</span>
00021 <span class="preprocessor">#if defined (WIN32)</span>
00022 <span class="preprocessor"></span><span class="preprocessor">#include &lt;crtdbg.h&gt;</span>
00023 <span class="preprocessor">#endif</span>
00024 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
00025 <span class="preprocessor">#include "<a class="code" href="_d_r_m_logger_8h.html">DRMLogger.h</a>"</span>
00026 
00027 <span class="keyword">using</span> <span class="keyword">namespace </span>DRMPlugin;
00028 <span class="keyword">using</span> <span class="keyword">namespace </span>MPEG2IPMPXDRMPlugin;
00029 
<a name="l00034"></a><a class="code" href="class_i_p_m_p_terminal.html">00034</a> <span class="keyword">class </span><a class="code" href="class_i_p_m_p_terminal.html">IPMPTerminal</a>: <span class="keyword">public</span> IIPMPTerminal {
00035 <span class="keyword">public</span>:
<a name="l00038"></a><a class="code" href="class_i_p_m_p_terminal.html#a0">00038</a>   <a class="code" href="class_i_p_m_p_terminal.html#a0">IPMPTerminal</a>() {
00039   }
00040 
00041   <span class="keyword">virtual</span> ~<a class="code" href="class_i_p_m_p_terminal.html">IPMPTerminal</a>() {
00042   }
00043 
<a name="l00050"></a><a class="code" href="class_i_p_m_p_terminal.html#a2">00050</a>   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="class_i_p_m_p_terminal.html#a2">UserText</a>(<span class="keyword">const</span> std::string&amp; text) {
00051     std::cout &lt;&lt; text;
00052     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00053   }
00054 
<a name="l00062"></a><a class="code" href="class_i_p_m_p_terminal.html#a3">00062</a>   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="class_i_p_m_p_terminal.html#a3">UserQA</a>(<span class="keyword">const</span> std::string&amp; query, std::string&amp; response) {
00063     std::cout &lt;&lt; query;
00064     std::cin &gt;&gt; response;
00065     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00066   }
00067 };
00068 
<a name="l00076"></a><a class="code" href="_m_p_e_g2_i_p_m_p_x_decoder_test_8cpp.html#a0">00076</a> <span class="keywordtype">bool</span> <a class="code" href="_m_p_e_g2_i_p_m_p_x_decoder_test_8cpp.html#a0">TStreamParseTest</a>(<a class="code" href="class_d_r_m_plugin_1_1_byte_seq.html">ByteSeq</a>&amp; stream, <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html">DRMLogger</a>&amp; logger) {
00077   MPEG2IPMPXTStreamParser tParser(<span class="keyword">new</span> IPMPToolManager(<span class="keyword">new</span> <a class="code" href="class_i_p_m_p_terminal.html">IPMPTerminal</a>(), logger), logger);
00078   <span class="keywordflow">return</span> tParser.ParseStream(stream);
00079 }
00080 
<a name="l00088"></a><a class="code" href="_m_p_e_g2_i_p_m_p_x_decoder_test_8cpp.html#a1">00088</a> <span class="keywordtype">bool</span> <a class="code" href="_m_p_e_g2_i_p_m_p_x_decoder_test_8cpp.html#a1">PStreamParseTest</a>(<a class="code" href="class_d_r_m_plugin_1_1_byte_seq.html">ByteSeq</a>&amp; stream, <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html">DRMLogger</a>&amp; logger) {
00089   MPEG2IPMPXPStreamParser pParser(<span class="keyword">new</span> IPMPToolManager(<span class="keyword">new</span> <a class="code" href="class_i_p_m_p_terminal.html">IPMPTerminal</a>(), logger), logger);
00090   <span class="keywordflow">return</span> pParser.ParseStream(stream);
00091 }
00092 
<a name="l00098"></a><a class="code" href="_m_p_e_g2_i_p_m_p_x_decoder_test_8cpp.html#a2">00098</a> <span class="keywordtype">int</span> <a class="code" href="_m_p_e_g2_i_p_m_p_x_encoder_test_8cpp.html#a0">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]) {
00099 <span class="preprocessor">#if defined (WIN32)</span>
00100 <span class="preprocessor"></span><span class="preprocessor">#if defined(_DEBUG)</span>
00101 <span class="preprocessor"></span>        <span class="keywordtype">int</span> tempflag = _CrtSetDbgFlag( _CRTDBG_REPORT_FLAG );
00102         tempflag |= _CRTDBG_LEAK_CHECK_DF;
00103         _CrtSetDbgFlag( tempflag );
00104 
00105   _CrtSetReportMode( _CRT_ASSERT, _CRTDBG_MODE_WNDW );
00106   _CrtSetReportMode( _CRT_WARN, _CRTDBG_MODE_WNDW );
00107   _CrtSetReportMode( _CRT_ERROR, _CRTDBG_MODE_WNDW );
00108 <span class="comment">//  _CrtSetReportFile( _CRT_ASSERT, _CRTDBG_FILE_STDERR );</span>
00109 <span class="comment">//  _CrtSetReportFile( _CRT_WARN, _CRTDBG_FILE_STDERR );</span>
00110 <span class="comment">//  _CrtSetReportFile( _CRT_ERROR, _CRTDBG_FILE_STDERR );</span>
00111 <span class="preprocessor">#endif // _DEBUG</span>
00112 <span class="preprocessor"></span><span class="preprocessor">#endif // WIN32</span>
00113 <span class="preprocessor"></span>
00114   <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html">DRMLogger</a> logger(ThreadSyncFactory::GetGlobalMutex());
00115 
00116   <span class="keywordflow">if</span> (argc &lt; 3) {
00117     std::cout &lt;&lt; <span class="stringliteral">"Wrong number of arguments."</span> &lt;&lt; std::endl;
00118     <span class="keywordflow">return</span> -1;
00119   }
00120 
00121   <span class="keyword">struct </span>stat tstat;
00122   stat(argv[1], &amp;tstat);
00123   FILE* in = fopen(argv[1], <span class="stringliteral">"rb"</span>);
00124   <span class="keywordflow">if</span> (in == NULL) {
00125     std::cout &lt;&lt; <span class="stringliteral">"Cannot open transport stream file."</span> &lt;&lt; std::endl;
00126     <span class="keywordflow">return</span> -1;
00127   }
00128   ByteT* buffer = (ByteT*)malloc(tstat.st_size);
00129   fread(buffer, tstat.st_size, 1, in);
00130   fclose(in);
00131 
00132   <a class="code" href="class_d_r_m_plugin_1_1_byte_seq.html">ByteSeq</a> tstream(buffer, tstat.st_size);
00133   free(buffer);
00134 
00135   <span class="keywordflow">if</span> (<a class="code" href="_m_p_e_g2_i_p_m_p_x_decoder_test_8cpp.html#a0">TStreamParseTest</a>(tstream, logger) == <span class="keyword">false</span>) {
00136     std::cout &lt;&lt; <span class="stringliteral">"Transport stream parse test failed."</span> &lt;&lt; std::endl;
00137     <span class="keywordflow">return</span> -1;
00138   }
00139 
00140   stat(argv[2], &amp;tstat);
00141   in = fopen(argv[2], <span class="stringliteral">"rb"</span>);
00142   <span class="keywordflow">if</span> (in == NULL) {
00143     std::cout &lt;&lt; <span class="stringliteral">"Cannot open program stream file."</span> &lt;&lt; std::endl;
00144     <span class="keywordflow">return</span> -1;
00145   }
00146   buffer = (ByteT*)malloc(tstat.st_size);
00147   fread(buffer, tstat.st_size, 1, in);
00148   fclose(in);
00149 
00150   <a class="code" href="class_d_r_m_plugin_1_1_byte_seq.html">ByteSeq</a> pstream(buffer, tstat.st_size);
00151   free(buffer);
00152 
00153   <span class="keywordflow">if</span> (<a class="code" href="_m_p_e_g2_i_p_m_p_x_decoder_test_8cpp.html#a1">PStreamParseTest</a>(pstream, logger) == <span class="keyword">false</span>) {
00154     std::cout &lt;&lt; <span class="stringliteral">"Program stream parse test failed."</span> &lt;&lt; std::endl;
00155     <span class="keywordflow">return</span> -1;
00156   }
00157 
00158   std::cout &lt;&lt; <span class="stringliteral">"Decoder test passed."</span> &lt;&lt; std::endl;
00159 
00160   <span class="keywordflow">return</span> 0;
00161 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Jun 10 19:17:59 2006 for "DRM Plugin Architecture" by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
