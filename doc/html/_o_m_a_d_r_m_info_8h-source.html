<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>&quot;DRM Plugin Architecture&quot;: OMADRMInfo.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>OMADRMInfo.h</h1><a href="_o_m_a_d_r_m_info_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00012 <span class="preprocessor">#if !defined (OMADRMINFO_H)</span>
00013 <span class="preprocessor"></span><span class="preprocessor">#define OMADRMINFO_H</span>
00014 <span class="preprocessor"></span>
00015 <span class="preprocessor">#include &lt;string&gt;</span>
00016 <span class="preprocessor">#include "<a class="code" href="_basic_types_8h.html">BasicTypes.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="_d_r_m_info_exception_8h.html">DRMInfoException.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="_d_r_m_logger_8h.html">DRMLogger.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="_i_cipher_8h.html">ICipher.h</a>"</span>
00020 
00022 <span class="keyword">namespace </span>DRMPlugin {
00023 
<a name="l00028"></a><a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html">00028</a> <span class="keyword">class </span><a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html">OMADRMInfo</a> {
00029 <span class="keyword">public</span>:
<a name="l00045"></a><a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a0">00045</a>   <a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a0">OMADRMInfo</a>(ByteT eMethod, ByteT ePadding, UInt64T pTLen, <span class="keyword">const</span> std::string&amp; conID,
00046       UInt16T s_version, <span class="keyword">const</span> std::string&amp; url, ByteT* headers, UInt16T headersLen,
00047       <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html">DRMLogger</a>&amp; logger): encMethod(eMethod), encPadding(ePadding), pTextLen(pTLen),
00048       contentID(conID), schemeVersion(s_version), riURL(url), silentHdr(),
00049       previewHdr(), contentURL(), contentVer(), contentLoc() {
00050     <span class="keywordflow">if</span> (contentID == <span class="stringliteral">""</span>) {
00051       logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OMADRMInfo::ctor: invalid content identifier."</span>);
00052       <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00053     }
00054     <span class="keywordflow">if</span> (<a class="code" href="namespace_d_r_m_plugin.html#a9">EncMethod</a>(encMethod) == <a class="code" href="namespace_d_r_m_plugin.html#a9a0">NULLENC</a>) {
00055       <span class="keywordflow">if</span> (encPadding != 0) {
00056         logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OMADRMInfo::ctor: invalid encryption method/padding."</span>);
00057         <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00058       }
00059     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespace_d_r_m_plugin.html#a9">EncMethod</a>(encMethod) == <a class="code" href="namespace_d_r_m_plugin.html#a9a1">AES128CBC</a>) {
00060       <span class="keywordflow">if</span> (encPadding != 1) {
00061         logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OMADRMInfo::ctor: invalid encryption method/padding."</span>);
00062         <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00063       }
00064     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespace_d_r_m_plugin.html#a9">EncMethod</a>(encMethod) == <a class="code" href="namespace_d_r_m_plugin.html#a9a2">AES128CTR</a>) {
00065       <span class="keywordflow">if</span> (encPadding != 0) {
00066         logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OMADRMInfo::ctor: invalid encryption method/padding."</span>);
00067         <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00068       }
00069     } <span class="keywordflow">else</span> {
00070       logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OMADRMInfo::ctor: invalid encryption method."</span>);
00071       <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00072     }
00073     <span class="keywordflow">if</span> (schemeVersion != 0x0200) {
00074       logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OMADRMInfo::ctor: unsupported version."</span>);
00075       <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00076     }
00077 
00078     <span class="keywordflow">if</span> ((headers != 0) &amp;&amp; (headersLen != 0)) {
00079       std::basic_string&lt;char&gt; tHdr((<span class="keywordtype">char</span>*)headers, (<span class="keywordtype">char</span>*)(headers + headersLen));
00080       <span class="keywordtype">int</span> index = 0, ret;
00081       <span class="keywordflow">while</span> (index &lt; headersLen) {
00082         ret = tHdr.find(<span class="charliteral">'\0'</span>, index);
00083         <span class="keywordflow">if</span> (ret == -1) {
00084           logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OMADRMInfo::ctor: invalid data while parsing OMA textual headers."</span>);
00085           <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00086           <span class="keywordflow">break</span>;
00087         }
00088         std::string sub = (<span class="keywordtype">char</span>*)(tHdr.data() + index);
00089         index = (ret + 1);
00090         ret = sub.find_first_of(<span class="charliteral">':'</span>, 0);
00091         <span class="keywordflow">if</span> (ret == -1) {
00092           logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OMADRMInfo::ctor: invalid data while parsing OMA textual headers."</span>);
00093           <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00094           <span class="keywordflow">break</span>;
00095         }
00096         std::string htype(sub.begin(), sub.begin() + ret);
00097               <span class="keywordflow">if</span> (htype == <span class="stringliteral">"Silent"</span>) {
00098           silentHdr = sub;
00099               } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (htype == <span class="stringliteral">"Preview"</span>) {
00100           previewHdr = sub;
00101               } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (htype == <span class="stringliteral">"ContentURL"</span>) {
00102           contentURL = sub;
00103               } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (htype == <span class="stringliteral">"ContentVersion"</span>) {
00104           contentVer = sub;
00105               } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (htype == <span class="stringliteral">"Content-Location"</span>) {
00106           contentLoc = sub;
00107         } <span class="keywordflow">else</span> {
00108           <span class="comment">// Custom header. Ignore.</span>
00109         }
00110       }
00111     }
00112   }
00113 
<a name="l00132"></a><a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a1">00132</a>   <a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a0">OMADRMInfo</a>(ByteT eMethod, ByteT ePadding, UInt64T pTLen, <span class="keyword">const</span> std::string&amp; conID,
00133       UInt16T s_version, <span class="keyword">const</span> std::string&amp; url, <span class="keyword">const</span> std::string&amp; silent,
00134       <span class="keyword">const</span> std::string&amp; preview, <span class="keyword">const</span> std::string&amp; conURL, <span class="keyword">const</span> std::string&amp;
00135       conVer, <span class="keyword">const</span> std::string&amp; conLoc, <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html">DRMLogger</a>&amp; logger): encMethod(eMethod),
00136       encPadding(ePadding), pTextLen(pTLen), contentID(conID), schemeVersion(s_version),
00137       riURL(url), silentHdr(silent), previewHdr(preview), contentURL(conURL),
00138       contentVer(conVer), contentLoc(conLoc) {
00139     <span class="keywordflow">if</span> (contentID == <span class="stringliteral">""</span>) {
00140       logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OMADRMInfo::ctor: invalid content identifier."</span>);
00141       <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00142     }
00143     <span class="keywordflow">if</span> (<a class="code" href="namespace_d_r_m_plugin.html#a9">EncMethod</a>(encMethod) == <a class="code" href="namespace_d_r_m_plugin.html#a9a0">NULLENC</a>) {
00144       <span class="keywordflow">if</span> (encPadding != 0) {
00145         logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OMADRMInfo::ctor: invalid encryption method/padding."</span>);
00146         <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00147       }
00148     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespace_d_r_m_plugin.html#a9">EncMethod</a>(encMethod) == <a class="code" href="namespace_d_r_m_plugin.html#a9a1">AES128CBC</a>) {
00149       <span class="keywordflow">if</span> (encPadding != 1) {
00150         logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OMADRMInfo::ctor: invalid encryption method/padding."</span>);
00151         <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00152       }
00153     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespace_d_r_m_plugin.html#a9">EncMethod</a>(encMethod) == <a class="code" href="namespace_d_r_m_plugin.html#a9a2">AES128CTR</a>) {
00154       <span class="keywordflow">if</span> (encPadding != 0) {
00155         logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OMADRMInfo::ctor: invalid encryption method/padding."</span>);
00156         <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00157       }
00158     } <span class="keywordflow">else</span> {
00159       logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OMADRMInfo::ctor: invalid encryption method."</span>);
00160       <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00161     }
00162     <span class="keywordflow">if</span> (schemeVersion != 0x0200) {
00163       logger.<a class="code" href="class_d_r_m_plugin_1_1_d_r_m_logger.html#a3">UpdateLog</a>(<span class="stringliteral">"OMADRMInfo::ctor: unsupported version."</span>);
00164       <span class="keywordflow">throw</span> <a class="code" href="class_d_r_m_plugin_1_1_d_r_m_info_exception.html">DRMInfoException</a>();
00165     }
00166   }
00167 
<a name="l00170"></a><a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a2">00170</a>   <a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a0">OMADRMInfo</a>(<span class="keyword">const</span> <a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html">OMADRMInfo</a>&amp; info): encMethod(info.encMethod),
00171     encPadding(info.encPadding), pTextLen(info.pTextLen), contentID(info.contentID),
00172     schemeVersion(info.schemeVersion), riURL(info.riURL), silentHdr(info.silentHdr),
00173     previewHdr(info.previewHdr), contentURL(info.contentURL),
00174     contentVer(info.contentVer), contentLoc(info.contentLoc) {
00175   }
00176 
<a name="l00181"></a><a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a3">00181</a>   ByteT <a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a3">GetEncMethod</a>()<span class="keyword"> const </span>{
00182     <span class="keywordflow">return</span> encMethod;
00183   }
00184 
<a name="l00189"></a><a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a4">00189</a>   ByteT <a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a4">GetEncPadding</a>()<span class="keyword"> const </span>{
00190     <span class="keywordflow">return</span> encPadding;
00191   }
00192 
<a name="l00197"></a><a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a5">00197</a>   UInt64T <a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a5">GetPlaintextLen</a>()<span class="keyword"> const </span>{
00198     <span class="keywordflow">return</span> pTextLen;
00199   }
00200 
<a name="l00205"></a><a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a6">00205</a>   <span class="keyword">const</span> std::string&amp; <a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a6">GetContentID</a>()<span class="keyword"> const </span>{
00206     <span class="keywordflow">return</span> contentID;
00207   }
00208 
<a name="l00213"></a><a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a7">00213</a>   UInt16T <a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a7">GetSchemeVersion</a>()<span class="keyword"> const </span>{
00214     <span class="keywordflow">return</span> schemeVersion;
00215   }
00216 
<a name="l00224"></a><a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a8">00224</a>   <span class="keyword">const</span> std::string&amp; <a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a8">GetRightsIssuerURL</a>()<span class="keyword"> const </span>{
00225     <span class="keywordflow">return</span> riURL;
00226   }
00227 
<a name="l00246"></a><a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a9">00246</a>   <span class="keyword">const</span> std::string&amp; <a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a9">GetSilentTextHeader</a>()<span class="keyword"> const </span>{
00247     <span class="keywordflow">return</span> silentHdr;
00248   }
00249 
<a name="l00263"></a><a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a10">00263</a>   <span class="keyword">const</span> std::string&amp; <a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a10">GetPreviewTextHeader</a>()<span class="keyword"> const </span>{
00264     <span class="keywordflow">return</span> previewHdr;
00265   }
00266 
<a name="l00277"></a><a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a11">00277</a>   <span class="keyword">const</span> std::string&amp; <a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a11">GetContentURLTextHeader</a>()<span class="keyword"> const </span>{
00278     <span class="keywordflow">return</span> contentURL;
00279   }
00280 
<a name="l00293"></a><a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a12">00293</a>   <span class="keyword">const</span> std::string&amp; <a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a12">GetContentVersionTextHeader</a>()<span class="keyword"> const </span>{
00294     <span class="keywordflow">return</span> contentVer;
00295   }
00296 
<a name="l00305"></a><a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a13">00305</a>   <span class="keyword">const</span> std::string&amp; <a class="code" href="class_d_r_m_plugin_1_1_o_m_a_d_r_m_info.html#a13">GetContentLocationTextHeader</a>()<span class="keyword"> const </span>{
00306     <span class="keywordflow">return</span> contentLoc;
00307   }
00308 
00309 <span class="keyword">private</span>:
00310   ByteT encMethod;
00311   ByteT encPadding;
00312   UInt64T pTextLen;
00313   std::string contentID;
00314   UInt16T schemeVersion;
00315   std::string riURL;
00316   std::string silentHdr;
00317   std::string previewHdr;
00318   std::string contentURL;
00319   std::string contentVer;
00320   std::string contentLoc;
00321 };
00322 
00323 } <span class="comment">// namespace DRMPlugin</span>
00324 
00325 <span class="preprocessor">#endif // !defined (OMADRMINFO_H)</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Jun 10 19:17:59 2006 for "DRM Plugin Architecture" by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
